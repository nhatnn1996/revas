{"ast":null,"code":"import _objectSpread from \"/Users/fimplus/Desktop/revasReal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"/Users/fimplus/Desktop/revasReal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/fimplus/Desktop/revasReal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { clamp, noop } from \"../../core/utils\";\n\nvar Scroller = /*#__PURE__*/function () {\n  function Scroller(listener) {\n    var _this = this;\n\n    _classCallCheck(this, Scroller);\n\n    this.listener = listener;\n    this._timestamp = 0;\n    this._x = new Handler();\n    this._y = new Handler();\n    this._tid = \"\";\n    this._timer = void 0;\n    this._offset = 0;\n    this.horizontal = false;\n\n    this.scrollAnimate = function () {\n      var condition = 16 * 420 - 160;\n\n      if (_this._x.offset > condition) {\n        _this._x.setOffset(0);\n      }\n\n      _this._x.onMove(26, 1);\n\n      _this.emit(\"start\");\n\n      _this._timer = requestAnimationFrame(_this.scrollAnimate);\n    };\n\n    this.touchStart = function (e) {\n      _this._timer = requestAnimationFrame(_this.scrollAnimate);\n    };\n\n    this.touchMove = function (e) {\n      if (_this._tid && e.touches[_this._tid] && _this._check(e)) {\n        var _e$touches$_this$_tid = e.touches[_this._tid],\n            x = _e$touches$_this$_tid.x,\n            y = _e$touches$_this$_tid.y;\n        var duration = e.timestamp - _this._timestamp;\n        _this._timestamp = e.timestamp;\n        _this.horizontal ? _this._x.onMove(x, duration) : _this._y.onMove(y, duration);\n\n        _this.emit(\"scroll\");\n\n        _this._sign(e);\n      }\n    };\n\n    this.touchEnd = function () {\n      if (_this._tid) {\n        _this._tid = \"\";\n        _this._timestamp = Date.now();\n\n        _this._x.onEnd();\n\n        _this._y.onEnd();\n\n        _this._timer = requestAnimationFrame(_this.afterEnd);\n      }\n    };\n\n    this.afterEnd = function () {\n      var timestamp = Date.now();\n      var duration = timestamp - _this._timestamp;\n      _this._timestamp = timestamp;\n\n      if (_this.horizontal ? _this._x.afterEnd(duration) : _this._y.afterEnd(duration)) {\n        _this.emit(\"scroll\");\n\n        _this._timer = requestAnimationFrame(_this.afterEnd);\n      } else {\n        _this.emit(\"end\");\n      }\n    };\n  }\n\n  _createClass(Scroller, [{\n    key: \"_sign\",\n    value: function _sign(e) {\n      var _this2 = this;\n\n      e.scroll = _objectSpread(_objectSpread({}, e.scroll), {}, {\n        x: true,\n        y: true\n      });\n      var stopPropagation = e.scroll.stopPropagation || noop;\n\n      if (this.horizontal) {\n        if (this._x.velocity > 0) {\n          e.scroll.y = false;\n          stopPropagation();\n        }\n\n        if (this._x.offset > 0 && this._x.offset < this._x.max) {\n          e.scroll.x = false;\n        }\n      } else {\n        if (this._y.velocity > 0) {\n          e.scroll.x = false;\n          stopPropagation();\n        }\n\n        if (this._y.offset > 0 && this._y.offset < this._y.max) {\n          e.scroll.y = false;\n        }\n      }\n\n      e.stopPropagation = function () {\n        _this2.touchEnd();\n\n        stopPropagation();\n      };\n    }\n  }, {\n    key: \"_check\",\n    value: function _check(e) {\n      if (this.horizontal && e.scroll && e.scroll.x === false) {\n        return this.touchEnd();\n      }\n\n      if (!this.horizontal && e.scroll && e.scroll.y === false) {\n        return this.touchEnd();\n      }\n\n      return true;\n    }\n  }, {\n    key: \"emit\",\n    value: function emit(type) {\n      this.listener({\n        type: type,\n        x: this._x.offset,\n        vx: this._x.velocity,\n        y: this._y.offset,\n        vy: this._y.velocity,\n        timestamp: this._timestamp,\n        tid: this._tid\n      });\n    }\n  }, {\n    key: \"cancel\",\n    value: function cancel() {\n      cancelAnimationFrame(this._timer);\n      this._tid = \"\";\n      this._timestamp = Date.now();\n\n      this._x.onEnd();\n\n      this._y.onEnd();\n    }\n  }, {\n    key: \"maxX\",\n    set: function set(value) {\n      this._x.max = value;\n    },\n    get: function get() {\n      return this._x.max;\n    }\n  }, {\n    key: \"maxY\",\n    set: function set(value) {\n      this._y.max = value;\n    },\n    get: function get() {\n      return this._y.max;\n    }\n  }, {\n    key: \"pagingX\",\n    set: function set(value) {\n      this._x.paging = value;\n    }\n  }, {\n    key: \"pagingY\",\n    set: function set(value) {\n      this._y.paging = value;\n    }\n  }]);\n\n  return Scroller;\n}();\n\nexport { Scroller as default };\n\nvar Handler = /*#__PURE__*/function () {\n  function Handler() {\n    _classCallCheck(this, Handler);\n\n    this.offset = 0;\n    this.velocity = 20;\n    this.max = -1;\n    this.paging = 0;\n    this._last = -1;\n  }\n\n  _createClass(Handler, [{\n    key: \"capture\",\n    //\n    value: function capture(value) {\n      if (this._last < 0) {\n        this._last = value;\n      }\n    }\n  }, {\n    key: \"onMove\",\n    value: function onMove(value, duration) {\n      if (duration > 0) {\n        var move = value;\n        this.velocity = move / duration; // quảng đường / thời gian = vận tốc\n\n        this.change(move);\n      }\n    }\n  }, {\n    key: \"onEnd\",\n    value: function onEnd() {\n      if (this._last >= 0) {\n        this._last = -1;\n      }\n    }\n  }, {\n    key: \"setOffset\",\n    value: function setOffset(value) {\n      this.offset = value;\n    }\n  }, {\n    key: \"afterEnd\",\n    value: function afterEnd(duration) {\n      if (this._last < 0) {\n        var absv = Math.abs(this.velocity);\n\n        if (this.paging > 0 && absv <= 0.5 && this.offset < this.max) {\n          // start reset to paging\n          var distance = Math.round(this.offset / this.paging + this.velocity) * this.paging - this.offset;\n          this.velocity = clamp(distance / 2000 + friction(this.velocity, duration, 0.01), -0.5, 0.5);\n\n          if (Math.abs(distance) > 0.5 || absv > 0.05) {\n            var move = this.velocity * duration;\n            this.change(move);\n            return true;\n          } else {\n            // end to paging\n            this.change(distance);\n          }\n        } else if (absv > 0.05) {\n          // scroll for free\n          this.velocity = friction(this.velocity, duration, 0.002);\n\n          var _move = this.velocity * duration;\n\n          this.change(_move);\n          return true;\n        } else {\n          this.velocity = 0;\n        }\n      }\n\n      return false;\n    }\n  }, {\n    key: \"change\",\n    value: function change(move) {\n      var _offset = clamp(this.offset + move, 0, this.max > 0 ? this.max : 0);\n\n      if (_offset !== this.offset) {\n        this.offset = _offset;\n      } else {\n        this.velocity = 0;\n      }\n    }\n  }]);\n\n  return Handler;\n}();\n\nfunction friction(v, duration, factor) {\n  return v - Math.min(duration * factor, 1) * v;\n}","map":{"version":3,"sources":["/Users/fimplus/Desktop/revasReal/src/revas/components/common/Scroller.ts"],"names":["clamp","noop","Scroller","listener","_timestamp","_x","Handler","_y","_tid","_timer","_offset","horizontal","scrollAnimate","condition","offset","setOffset","onMove","emit","requestAnimationFrame","touchStart","e","touchMove","touches","_check","x","y","duration","timestamp","_sign","touchEnd","Date","now","onEnd","afterEnd","scroll","stopPropagation","velocity","max","type","vx","vy","tid","cancelAnimationFrame","value","paging","_last","move","change","absv","Math","abs","distance","round","friction","v","factor","min"],"mappings":"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","sourcesContent":["import { RevasTouchEvent } from \"../../core/Node\";\nimport { clamp, noop } from \"../../core/utils\";\n\nexport type RevasScrollEventType = \"start\" | \"scroll\" | \"end\" | \"none\";\n\nexport interface RevasScrollEvent {\n  type: RevasScrollEventType;\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  timestamp: number;\n  tid: string;\n}\n\nexport default class Scroller {\n  private _timestamp = 0;\n  private _x = new Handler();\n  private _y = new Handler();\n  private _tid = \"\";\n  private _timer: any;\n  private _offset = 0;\n\n  horizontal?: boolean = false;\n\n  constructor(private listener: (e: any) => any) {}\n\n  set maxX(value: number) {\n    this._x.max = value;\n  }\n\n  get maxX() {\n    return this._x.max;\n  }\n\n  set maxY(value: number) {\n    this._y.max = value;\n  }\n\n  get maxY() {\n    return this._y.max;\n  }\n\n  set pagingX(value: number) {\n    this._x.paging = value;\n  }\n\n  set pagingY(value: number) {\n    this._y.paging = value;\n  }\n\n  private _sign(e: RevasTouchEvent) {\n    e.scroll = { ...e.scroll, x: true, y: true };\n    const stopPropagation = e.scroll.stopPropagation || noop;\n    if (this.horizontal) {\n      if (this._x.velocity > 0) {\n        e.scroll.y = false;\n        stopPropagation();\n      }\n      if (this._x.offset > 0 && this._x.offset < this._x.max) {\n        e.scroll.x = false;\n      }\n    } else {\n      if (this._y.velocity > 0) {\n        e.scroll.x = false;\n        stopPropagation();\n      }\n      if (this._y.offset > 0 && this._y.offset < this._y.max) {\n        e.scroll.y = false;\n      }\n    }\n    e.stopPropagation = () => {\n      this.touchEnd();\n      stopPropagation();\n    };\n  }\n\n  private _check(e: RevasTouchEvent) {\n    if (this.horizontal && e.scroll && e.scroll.x === false) {\n      return this.touchEnd();\n    }\n    if (!this.horizontal && e.scroll && e.scroll.y === false) {\n      return this.touchEnd();\n    }\n    return true;\n  }\n\n  scrollAnimate = () => {\n    const condition = 16 * 420 - 160;\n    if (this._x.offset > condition) {\n      this._x.setOffset(0);\n    }\n    this._x.onMove(26, 1);\n    this.emit(\"start\");\n    this._timer = requestAnimationFrame(this.scrollAnimate);\n  };\n\n  touchStart = (e: any) => {\n    this._timer = requestAnimationFrame(this.scrollAnimate);\n  };\n\n  touchMove = (e: RevasTouchEvent) => {\n    if (this._tid && e.touches[this._tid] && this._check(e)) {\n      const { x, y } = e.touches[this._tid];\n      const duration = e.timestamp - this._timestamp;\n      this._timestamp = e.timestamp;\n      this.horizontal ? this._x.onMove(x, duration) : this._y.onMove(y, duration);\n      this.emit(\"scroll\");\n      this._sign(e);\n    }\n  };\n\n  touchEnd = () => {\n    if (this._tid) {\n      this._tid = \"\";\n      this._timestamp = Date.now();\n      this._x.onEnd();\n      this._y.onEnd();\n      this._timer = requestAnimationFrame(this.afterEnd);\n    }\n  };\n\n  afterEnd = () => {\n    const timestamp = Date.now();\n    const duration = timestamp - this._timestamp;\n    this._timestamp = timestamp;\n    if (this.horizontal ? this._x.afterEnd(duration) : this._y.afterEnd(duration)) {\n      this.emit(\"scroll\");\n      this._timer = requestAnimationFrame(this.afterEnd);\n    } else {\n      this.emit(\"end\");\n    }\n  };\n\n  emit(type: RevasScrollEventType) {\n    this.listener({\n      type,\n      x: this._x.offset,\n      vx: this._x.velocity,\n      y: this._y.offset,\n      vy: this._y.velocity,\n      timestamp: this._timestamp,\n      tid: this._tid,\n    });\n  }\n\n  cancel() {\n    cancelAnimationFrame(this._timer);\n    this._tid = \"\";\n    this._timestamp = Date.now();\n    this._x.onEnd();\n    this._y.onEnd();\n  }\n}\n\nclass Handler {\n  offset = 0;\n  velocity = 20;\n  max = -1;\n  paging = 0;\n\n  private _last = -1;\n\n  //\n\n  capture(value: number) {\n    if (this._last < 0) {\n      this._last = value;\n    }\n  }\n\n  onMove(value: number, duration: number) {\n    if (duration > 0) {\n      const move = value;\n      this.velocity = move / duration; // quảng đường / thời gian = vận tốc\n      this.change(move);\n    }\n  }\n  onEnd() {\n    if (this._last >= 0) {\n      this._last = -1;\n    }\n  }\n  setOffset(value: number) {\n    this.offset = value;\n  }\n\n  afterEnd(duration: number) {\n    if (this._last < 0) {\n      const absv = Math.abs(this.velocity);\n      if (this.paging > 0 && absv <= 0.5 && this.offset < this.max) {\n        // start reset to paging\n        const distance = Math.round(this.offset / this.paging + this.velocity) * this.paging - this.offset;\n        this.velocity = clamp(distance / 2000 + friction(this.velocity, duration, 0.01), -0.5, 0.5);\n        if (Math.abs(distance) > 0.5 || absv > 0.05) {\n          const move = this.velocity * duration;\n          this.change(move);\n          return true;\n        } else {\n          // end to paging\n          this.change(distance);\n        }\n      } else if (absv > 0.05) {\n        // scroll for free\n        this.velocity = friction(this.velocity, duration, 0.002);\n        const move = this.velocity * duration;\n        this.change(move);\n        return true;\n      } else {\n        this.velocity = 0;\n      }\n    }\n    return false;\n  }\n\n  change(move: number) {\n    const _offset = clamp(this.offset + move, 0, this.max > 0 ? this.max : 0);\n    if (_offset !== this.offset) {\n      this.offset = _offset;\n    } else {\n      this.velocity = 0;\n    }\n  }\n}\n\nfunction friction(v: number, duration: number, factor: number) {\n  return v - Math.min(duration * factor, 1) * v;\n}\n"]},"metadata":{},"sourceType":"module"}
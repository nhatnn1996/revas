{"ast":null,"code":"import _objectSpread from \"/Users/fimplus/Desktop/revasReal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"/Users/fimplus/Desktop/revasReal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/fimplus/Desktop/revasReal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/fimplus/Desktop/revasReal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/fimplus/Desktop/revasReal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport * as React from 'react';\nimport ScrollView from './ScrollView';\n\nvar ListView = /*#__PURE__*/function (_React$Component) {\n  _inherits(ListView, _React$Component);\n\n  var _super = _createSuper(ListView);\n\n  function ListView() {\n    var _this;\n\n    _classCallCheck(this, ListView);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      start: 0,\n      end: 1\n    };\n    _this._height = 0;\n\n    _this.checkVisible = function (y) {\n      if (_this._height > 0) {\n        var itemHeight = _this.props.itemHeight;\n        var _this$state = _this.state,\n            _start = _this$state.start,\n            _end = _this$state.end;\n        var start = Math.max(0, Math.floor((y - 10) / itemHeight));\n        var end = Math.floor((y + _this._height + 10) / itemHeight);\n\n        if (start !== _start || end !== _end) {\n          _this.setState({\n            start: start,\n            end: end\n          });\n        }\n      }\n    };\n\n    _this._onScroll = function (e) {\n      _this.checkVisible(e.y);\n\n      _this.props.onScroll && _this.props.onScroll(e);\n    };\n\n    _this._onLayout = function (frame) {\n      if (_this._height !== frame.height) {\n        _this._height = frame.height;\n      } // this._width = frame.width\n\n    };\n\n    _this.renderItem = function (item, i) {\n      var _this$props = _this.props,\n          data = _this$props.data,\n          renderItem = _this$props.renderItem;\n      var index = i + _this.state.start;\n      return React.createElement(React.Fragment, {\n        key: index\n      }, renderItem(item, index, data));\n    };\n\n    return _this;\n  }\n\n  _createClass(ListView, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.checkVisible(0);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props2 = this.props,\n          data = _this$props2.data,\n          itemHeight = _this$props2.itemHeight;\n      var _this$state2 = this.state,\n          start = _this$state2.start,\n          end = _this$state2.end; // console.log(start, end, this._height);\n\n      return React.createElement(ScrollView, _objectSpread(_objectSpread({}, this.props), {}, {\n        onScroll: this._onScroll,\n        onLayout: this._onLayout,\n        offset: {\n          y: start * itemHeight\n        }\n      }), data.slice(start, end + 1).map(this.renderItem));\n    }\n  }]);\n\n  return ListView;\n}(React.Component);\n\nexport { ListView as default };","map":{"version":3,"sources":["/Users/fimplus/Desktop/revasReal/src/revas/components/ListView.ts"],"names":["React","ScrollView","ListView","state","start","end","_height","checkVisible","y","itemHeight","props","_start","_end","Math","max","floor","setState","_onScroll","e","onScroll","_onLayout","frame","height","renderItem","item","i","data","index","createElement","Fragment","key","onLayout","offset","slice","map","Component"],"mappings":";;;;;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AAEA,OAAOC,UAAP,MAA4C,cAA5C;;IASqBC,Q;;;;;;;;;;;;;;;UACnBC,K,GAAQ;AACNC,MAAAA,KAAK,EAAE,CADD;AAENC,MAAAA,GAAG,EAAE;AAFC,K;UAKAC,O,GAAU,C;;UAMVC,Y,GAAe,UAACC,CAAD,EAAe;AACpC,UAAI,MAAKF,OAAL,GAAe,CAAnB,EAAsB;AAAA,YACZG,UADY,GACG,MAAKC,KADR,CACZD,UADY;AAAA,0BAEiB,MAAKN,KAFtB;AAAA,YAELQ,MAFK,eAEZP,KAFY;AAAA,YAEQQ,IAFR,eAEGP,GAFH;AAGpB,YAAMD,KAAK,GAAGS,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYD,IAAI,CAACE,KAAL,CAAW,CAACP,CAAC,GAAG,EAAL,IAAWC,UAAtB,CAAZ,CAAd;AACA,YAAMJ,GAAG,GAAGQ,IAAI,CAACE,KAAL,CAAW,CAACP,CAAC,GAAG,MAAKF,OAAT,GAAmB,EAApB,IAA0BG,UAArC,CAAZ;;AACA,YAAIL,KAAK,KAAKO,MAAV,IAAoBN,GAAG,KAAKO,IAAhC,EAAsC;AACpC,gBAAKI,QAAL,CAAc;AAAEZ,YAAAA,KAAK,EAALA,KAAF;AAASC,YAAAA,GAAG,EAAHA;AAAT,WAAd;AACD;AACF;AACF,K;;UAEOY,S,GAAY,UAACC,CAAD,EAAyB;AAC3C,YAAKX,YAAL,CAAkBW,CAAC,CAACV,CAApB;;AACA,YAAKE,KAAL,CAAWS,QAAX,IAAuB,MAAKT,KAAL,CAAWS,QAAX,CAAoBD,CAApB,CAAvB;AACD,K;;UAEOE,S,GAAY,UAACC,KAAD,EAAkB;AACpC,UAAI,MAAKf,OAAL,KAAiBe,KAAK,CAACC,MAA3B,EAAmC;AACjC,cAAKhB,OAAL,GAAee,KAAK,CAACC,MAArB;AACD,OAHmC,CAIpC;;AACD,K;;UAEDC,U,GAAa,UAACC,IAAD,EAAYC,CAAZ,EAA0B;AAAA,wBACR,MAAKf,KADG;AAAA,UAC7BgB,IAD6B,eAC7BA,IAD6B;AAAA,UACvBH,UADuB,eACvBA,UADuB;AAErC,UAAMI,KAAK,GAAGF,CAAC,GAAG,MAAKtB,KAAL,CAAWC,KAA7B;AACA,aAAOJ,KAAK,CAAC4B,aAAN,CAAoB5B,KAAK,CAAC6B,QAA1B,EAAoC;AAAEC,QAAAA,GAAG,EAAEH;AAAP,OAApC,EAAoDJ,UAAU,CAACC,IAAD,EAAOG,KAAP,EAAcD,IAAd,CAA9D,CAAP;AACD,K;;;;;;;wCAhCmB;AAClB,WAAKnB,YAAL,CAAkB,CAAlB;AACD;;;6BAgCQ;AAAA,yBACsB,KAAKG,KAD3B;AAAA,UACCgB,IADD,gBACCA,IADD;AAAA,UACOjB,UADP,gBACOA,UADP;AAAA,yBAEgB,KAAKN,KAFrB;AAAA,UAECC,KAFD,gBAECA,KAFD;AAAA,UAEQC,GAFR,gBAEQA,GAFR,EAGP;;AACA,aAAOL,KAAK,CAAC4B,aAAN,CACL3B,UADK,kCAGA,KAAKS,KAHL;AAIHS,QAAAA,QAAQ,EAAE,KAAKF,SAJZ;AAKHc,QAAAA,QAAQ,EAAE,KAAKX,SALZ;AAMHY,QAAAA,MAAM,EAAE;AAAExB,UAAAA,CAAC,EAAEJ,KAAK,GAAGK;AAAb;AANL,UAQLiB,IAAI,CAACO,KAAL,CAAW7B,KAAX,EAAkBC,GAAG,GAAG,CAAxB,EAA2B6B,GAA3B,CAA+B,KAAKX,UAApC,CARK,CAAP;AAUD;;;;EAxDmCvB,KAAK,CAACmC,S;;SAAvBjC,Q","sourcesContent":["import * as React from 'react';\nimport { RevasScrollEvent } from './common/Scroller';\nimport ScrollView, { ScrollViewProps } from './ScrollView';\nimport { Frame } from '../core/Node';\n\nexport type ListViewProps<T = any> = {\n  data: T[];\n  renderItem: (item: T, index: number, data: T[]) => React.ReactNode;\n  itemHeight: number;\n} & ScrollViewProps;\n\nexport default class ListView extends React.Component<ListViewProps<any>> {\n  state = {\n    start: 0,\n    end: 1,\n  };\n\n  private _height = 0;\n\n  componentDidMount() {\n    this.checkVisible(0);\n  }\n\n  private checkVisible = (y: number) => {\n    if (this._height > 0) {\n      const { itemHeight } = this.props;\n      const { start: _start, end: _end } = this.state;\n      const start = Math.max(0, Math.floor((y - 10) / itemHeight));\n      const end = Math.floor((y + this._height + 10) / itemHeight);\n      if (start !== _start || end !== _end) {\n        this.setState({ start, end });\n      }\n    }\n  };\n\n  private _onScroll = (e: RevasScrollEvent) => {\n    this.checkVisible(e.y);\n    this.props.onScroll && this.props.onScroll(e);\n  };\n\n  private _onLayout = (frame: Frame) => {\n    if (this._height !== frame.height) {\n      this._height = frame.height;\n    }\n    // this._width = frame.width\n  };\n\n  renderItem = (item: any, i: number) => {\n    const { data, renderItem } = this.props;\n    const index = i + this.state.start;\n    return React.createElement(React.Fragment, { key: index }, renderItem(item, index, data));\n  };\n\n  render() {\n    const { data, itemHeight } = this.props;\n    const { start, end } = this.state;\n    // console.log(start, end, this._height);\n    return React.createElement(\n      ScrollView,\n      {\n        ...this.props,\n        onScroll: this._onScroll,\n        onLayout: this._onLayout,\n        offset: { y: start * itemHeight },\n      },\n      data.slice(start, end + 1).map(this.renderItem)\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}